#!/bin/bash

# ==========================================
# ã€è¨­å®šã€‘ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆç’°å¢ƒå¤‰æ•°ã§ä¸Šæ›¸ãå¯èƒ½ï¼‰
# ==========================================
LOCAL_ROOT="${REPOS_BASE_PATH}"
REPOS="${REPOS}"
ME="${AUTHOR}" # ã‚ãªãŸã®GitHub ID
PR_LIMIT="${STATS_REVIEW_PR_LIMIT:-100}" # é›†è¨ˆå¯¾è±¡ã®PRä»¶æ•°
SAMPLE_LIMIT="${STATS_REVIEW_SAMPLE_LIMIT:-100}" # å¹³å‡ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚é–“è¨ˆç®—ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ•°

# è‰²ã®å®šç¾©
GREEN=$'\033[0;32m'
RED=$'\033[0;31m'
RESET=$'\033[0m'
# ==========================================

# æ™‚é–“å¤‰æ›é–¢æ•°
format_seconds() {
    local T=$1
    local D=$((T/60/60/24))
    local H=$((T/60/60%24))
    local M=$((T/60%60))

    if [ "$D" -gt 0 ]; then
        printf "%dæ—¥ %dæ™‚é–“" "$D" "$H"
    elif [ "$H" -gt 0 ]; then
        printf "%dæ™‚é–“ %dåˆ†" "$H" "$M"
    else
        printf "%dåˆ†" "$M"
    fi
}

echo "ğŸ“Š ãƒ¬ãƒ“ãƒ¥ãƒ¼è²¢çŒ®ãƒ»é€Ÿåº¦æŒ‡æ¨™é›†è¨ˆï¼ˆãƒãƒ¼ãƒ æ¯”è¼ƒä»˜ãï¼‰"
echo "ğŸ‘¤ Reviewer: ${ME}"
echo "ğŸ“¦ é›†è¨ˆå¯¾è±¡: å„ãƒªãƒã‚¸ãƒˆãƒªã®ç›´è¿‘ ${PR_LIMIT}ä»¶ã®ãƒãƒ¼ã‚¸æ¸ˆã¿PRï¼ˆã€releaseã€‘ã€hotfixã€‘é™¤ãã€reviewersãƒãƒ¼ãƒ æŒ‡å®šå¿…é ˆï¼‰"
echo "â±  æ»ç•™æ™‚é–“è¨ˆæ¸¬: è‡ªåˆ†ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸPRã®ç›´è¿‘ ${SAMPLE_LIMIT}ä»¶ã‹ã‚‰ç®—å‡º"
echo "   (â€» reviewersãƒãƒ¼ãƒ æŒ‡å®šæ™‚åˆ» ã€œ ã‚ãªãŸã®æœ€åˆã®ã‚³ãƒ¡ãƒ³ãƒˆ/ãƒ¬ãƒ“ãƒ¥ãƒ¼ ã¾ã§ã®æ™‚é–“)"
echo "   (â€» vs Team(Time): 2.0xé€Ÿã„ = ãƒãƒ¼ãƒ ã‚ˆã‚Š2å€é€Ÿã„ã€1.5xé…ã„ = ãƒãƒ¼ãƒ ã‚ˆã‚Š1.5å€é…ã„)"
echo "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------"
printf "%-20s | %-8s | %-8s | %-8s | %-10s | %-14s | %-16s | %-16s | %-13s\n" "Repository" "Others" "Reviewed" "My Rate" "Team Avg" "vs Team(Rate)" "My Lead Time" "Team Lead Time" "vs Team(Time)"
echo "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------"

# ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä¿å­˜
ORIGINAL_DIR=$(pwd)

for repo in $REPOS; do
    REPO_PATH="${LOCAL_ROOT}/${repo}"

    # ãƒªãƒã‚¸ãƒˆãƒªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
    if [ ! -d "$REPO_PATH" ]; then
        printf "%-20s | %-12s | %-12s | %-8s | %s\n" "${repo:0:20}" "-" "-" "-" "(Dir not found)"
        continue
    fi

    # ãƒªãƒã‚¸ãƒˆãƒªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
    cd "$REPO_PATH" 2>/dev/null || {
        printf "%-20s | %-12s | %-12s | %-8s | %s\n" "${repo:0:20}" "-" "-" "-" "(Cannot cd)"
        continue
    }

    # ãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±ã‚’å–å¾—
    REPO_INFO=$(gh repo view --json owner,name 2>/dev/null)
    if [ $? -ne 0 ]; then
        printf "%-20s | %-12s | %-12s | %-8s | %s\n" "${repo:0:20}" "-" "-" "-" "(Not a gh repo)"
        cd "$ORIGINAL_DIR"
        continue
    fi

    OWNER=$(echo "$REPO_INFO" | jq -r .owner.login | tr -d '[:space:]')
    REPO_NAME=$(echo "$REPO_INFO" | jq -r .name | tr -d '[:space:]')

    # GraphQL ã‚¯ã‚¨ãƒªã§ PR ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    # 1. ä»–äººã®PRç·æ•°ï¼ˆãƒãƒ¼ã‚¸æ¸ˆã¿ã€è‡ªåˆ†ä»¥å¤–ã®ä½œæˆè€…ï¼‰
    # 2. è‡ªåˆ†ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸPRæ•°
    # 3. è‡ªåˆ†ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸPRã®è©³ç´°ï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚é–“è¨ˆç®—ç”¨ï¼‰

    QUERY="
    query {
        viewer { login }
        repository(owner: \"$OWNER\", name: \"$REPO_NAME\") {
            pullRequests(
                first: $PR_LIMIT,
                states: MERGED,
                orderBy: {field: CREATED_AT, direction: DESC}
            ) {
                totalCount
                nodes {
                    number
                    title
                    createdAt
                    author { login }
                    reviews(first: 100) {
                        nodes {
                            author { login }
                            submittedAt
                        }
                    }
                    comments(first: 100) {
                        nodes {
                            author { login }
                            createdAt
                        }
                    }
                    timelineItems(first: 100, itemTypes: [REVIEW_REQUESTED_EVENT]) {
                        nodes {
                            ... on ReviewRequestedEvent {
                                createdAt
                                requestedReviewer {
                                    ... on Team {
                                        slug
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    "

    # APIå‘¼ã³å‡ºã—å‰ã«ã‚¹ãƒªãƒ¼ãƒ—ï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™å›é¿ï¼‰
    sleep 2

    # GraphQL APIã‚’å®Ÿè¡Œï¼ˆã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã‚‚ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼‰
    API_RESPONSE=$(gh api graphql -f query="$QUERY" 2>&1)
    API_EXIT_CODE=$?

    # APIã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
    if [ $API_EXIT_CODE -ne 0 ]; then
        ERROR_MSG=$(echo "$API_RESPONSE" | head -n 1 | cut -c1-60)
        printf "%-20s | %-12s | %-12s | %-8s | %s\n" "${repo:0:20}" "-" "-" "-" "(API error: $ERROR_MSG)"
        cd "$ORIGINAL_DIR"
        continue
    fi

    # jqã§é›†è¨ˆ
    RESULT=$(echo "$API_RESPONSE" | jq -r --arg ME "$ME" --argjson SAMPLE_LIMIT "$SAMPLE_LIMIT" '
        # è‡ªåˆ†ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆviewerã‹ã‚‰å–å¾—ï¼‰
        .data.viewer.login as $viewer_login |

        # PRãƒªã‚¹ãƒˆã‚’å–å¾—ï¼ˆç›´è¿‘PR_LIMITä»¶ã®ãƒãƒ¼ã‚¸æ¸ˆã¿PRï¼‰
        # ã‚¿ã‚¤ãƒˆãƒ«ã«ã€releaseã€‘ã¾ãŸã¯ã€hotfixã€‘ãŒå«ã¾ã‚Œã‚‹PRã‚’é™¤å¤–ï¼ˆå¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥ãªã—ï¼‰
        # å…¨è§’ã€ã€‘ã€åŠè§’[]ã€æ‹¬å¼§ãªã—ã®3ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œ
        # reviewersãƒãƒ¼ãƒ æŒ‡å®šãŒãªã„PRã‚’é™¤å¤–
        .data.repository.pullRequests.nodes
        | map(select(
            (.title | test("(release|hotfix)"; "i") | not) and
            (.title | test("\\[(release|hotfix)\\]"; "i") | not) and
            (.title | test("^(release|hotfix)"; "i") | not) and
            (.timelineItems.nodes // [] | map(select(.requestedReviewer.slug == "reviewers")) | length > 0)
        )) as $prs |

        # 1. ä»–äººãŒä½œæˆã—ãŸPRï¼ˆè‡ªåˆ†ä»¥å¤–ï¼‰
        ($prs | map(select(.author.login != $ME))) as $others_prs |
        ($others_prs | length) as $total_others_count |

        # 2. è‡ªåˆ†ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸPR
        ($others_prs | map(
            select(
                (.reviews.nodes // [] | map(.author.login) | index($ME)) or
                (.comments.nodes // [] | map(.author.login) | index($ME))
            )
        )) as $reviewed_prs |
        ($reviewed_prs | length) as $reviewed_count |

        # 3. ãƒ¬ãƒ“ãƒ¥ãƒ¼ç‡
        (if $total_others_count > 0 then
            ($reviewed_count / $total_others_count * 100)
        else 0 end) as $review_rate |

        # 4. å¹³å‡ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚é–“ï¼ˆã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ï¼‰
        ($reviewed_prs[0:$SAMPLE_LIMIT] | map(
            # ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚åˆ»ã‚’å–å¾—ï¼ˆreviewersãƒãƒ¼ãƒ æŒ‡å®šæ™‚åˆ»ï¼‰
            (
                .timelineItems.nodes // []
                | map(select(.requestedReviewer.slug == "reviewers") | .createdAt)
                | .[0]
            ) as $review_requested_at |

            # é–‹å§‹æ™‚åˆ»ï¼šãƒãƒ¼ãƒ æŒ‡å®šãŒã‚ã‚Œã°ãã®æ™‚åˆ»ã€ãªã‘ã‚Œã°PRä½œæˆæ™‚åˆ»
            (if $review_requested_at then $review_requested_at else .createdAt end) as $start_time |

            # è‡ªåˆ†ã®æœ€åˆã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ™‚åˆ»
            (
                [
                    (.reviews.nodes // [] | map(select(.author.login == $ME) | .submittedAt)),
                    (.comments.nodes // [] | map(select(.author.login == $ME) | .createdAt))
                ] | flatten | map(select(. != null)) | sort | .[0]
            ) as $first_action |

            if $first_action then
                (($first_action | fromdateiso8601) - ($start_time | fromdateiso8601))
            else
                null
            end
        ) | map(select(. != null and . >= 0))) as $review_times |

        ($review_times | length) as $sample_count |
        (if $sample_count > 0 then
            ($review_times | add / $sample_count | floor)
        else
            null
        end) as $avg_seconds |

        # === ãƒãƒ¼ãƒ çµ±è¨ˆã®è¨ˆç®— ===

        # 5. å„PRã«å¯¾ã—ã¦ã€èª°ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸã‹ã‚’é›†è¨ˆ
        ($others_prs | map(
            # å„PRã®ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ãƒªã‚¹ãƒˆã‚’ä½œæˆï¼ˆé‡è¤‡æ’é™¤ï¼‰
            [
                (.reviews.nodes // [] | map(.author.login)),
                (.comments.nodes // [] | map(.author.login))
            ] | flatten | unique | map(select(. != null and . != "github-actions"))
        )) as $pr_reviewers_list |

        # 6. å…¨ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ï¼ˆè‡ªåˆ†ã‚’é™¤ãï¼‰
        ($pr_reviewers_list | flatten | unique | map(select(. != $ME))) as $team_members |

        # 7. ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã”ã¨ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
        ($team_members | map(
            . as $member |
            {
                member: $member,
                count: ($pr_reviewers_list | map(select(index($member))) | length)
            }
        )) as $team_review_counts |

        # 8. ãƒãƒ¼ãƒ å¹³å‡ãƒ¬ãƒ“ãƒ¥ãƒ¼ç‡
        (if ($team_members | length) > 0 then
            (($team_review_counts | map(.count) | add) / (($team_members | length) * $total_others_count) * 100)
        else
            null
        end) as $team_avg_rate |

        # 9. ãƒãƒ¼ãƒ å¹³å‡ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚é–“
        # å„ãƒ¡ãƒ³ãƒãƒ¼ã®å¹³å‡ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚é–“ã‚’è¨ˆç®—ã—ã€ãã®å¹³å‡ã‚’å–ã‚‹
        ($team_members | map(
            . as $member |
            ($others_prs | map(
                # ã“ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸPRã®ã¿
                select(
                    (.reviews.nodes // [] | map(.author.login) | index($member)) or
                    (.comments.nodes // [] | map(.author.login) | index($member))
                ) |

                # ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚åˆ»ã‚’å–å¾—ï¼ˆreviewersãƒãƒ¼ãƒ æŒ‡å®šæ™‚åˆ»ï¼‰
                (
                    .timelineItems.nodes // []
                    | map(select(.requestedReviewer.slug == "reviewers") | .createdAt)
                    | .[0]
                ) as $review_requested_at |

                # é–‹å§‹æ™‚åˆ»ï¼šãƒãƒ¼ãƒ æŒ‡å®šãŒã‚ã‚Œã°ãã®æ™‚åˆ»ã€ãªã‘ã‚Œã°PRä½œæˆæ™‚åˆ»
                (if $review_requested_at then $review_requested_at else .createdAt end) as $start_time |

                # ãƒ¡ãƒ³ãƒãƒ¼ã®æœ€åˆã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ™‚åˆ»
                (
                    [
                        (.reviews.nodes // [] | map(select(.author.login == $member) | .submittedAt)),
                        (.comments.nodes // [] | map(select(.author.login == $member) | .createdAt))
                    ] | flatten | map(select(. != null)) | sort | .[0]
                ) as $first_action |

                if $first_action then
                    (($first_action | fromdateiso8601) - ($start_time | fromdateiso8601))
                else
                    null
                end
            ) | map(select(. != null and . >= 0)))
        ) | map(if length > 0 then (add / length) else null end) | map(select(. != null))) as $team_review_times |

        (if ($team_review_times | length) > 0 then
            ($team_review_times | add / length | floor)
        else
            null
        end) as $team_avg_seconds |

        # çµæœã‚’å‡ºåŠ›
        {
            total_others_count: $total_others_count,
            reviewed_count: $reviewed_count,
            review_rate: $review_rate,
            avg_seconds: $avg_seconds,
            team_avg_rate: $team_avg_rate,
            team_avg_seconds: $team_avg_seconds
        } | @json
    ')

    # jqã®çµæœã‚’ãƒ‘ãƒ¼ã‚¹
    if [ -z "$RESULT" ] || [ "$RESULT" = "null" ]; then
        printf "%-20s | %-12s | %-12s | %-8s | %s\n" "${repo:0:20}" "-" "-" "-" "(Parse error)"
        cd "$ORIGINAL_DIR"
        continue
    fi

    total_others_count=$(echo "$RESULT" | jq -r .total_others_count)
    reviewed_count=$(echo "$RESULT" | jq -r .reviewed_count)
    review_rate=$(echo "$RESULT" | jq -r .review_rate)
    avg_seconds=$(echo "$RESULT" | jq -r .avg_seconds)
    team_avg_rate=$(echo "$RESULT" | jq -r .team_avg_rate)
    team_avg_seconds=$(echo "$RESULT" | jq -r .team_avg_seconds)

    # ãƒ¬ãƒ“ãƒ¥ãƒ¼ç‡ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    review_rate_str=$(printf "%.1f%%" "$review_rate")

    # ãƒãƒ¼ãƒ å¹³å‡ãƒ¬ãƒ“ãƒ¥ãƒ¼ç‡ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    if [ "$team_avg_rate" != "null" ] && [ -n "$team_avg_rate" ]; then
        team_avg_rate_str=$(printf "%.1f%%" "$team_avg_rate")
        # vs Teamï¼ˆå·®åˆ†ï¼‰
        diff=$(awk "BEGIN {printf \"%.1f\", $review_rate - $team_avg_rate}")
        if (( $(awk "BEGIN {print ($diff > 0)}") )); then
            # ãƒ—ãƒ©ã‚¹ï¼ˆè‰¯ã„ï¼‰â†’ç·‘è‰²
            visible_str=$(printf "+%.1f%%" "$diff")
            vs_team_str="${GREEN}${visible_str}${RESET}"
            # ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ç”¨ã«å¯è¦–æ–‡å­—åˆ—ã®é•·ã•ã‚’è¨ˆç®—ï¼ˆåˆ—å¹…14ï¼‰
            padding=$((14 - ${#visible_str}))
            vs_team_str="${vs_team_str}$(printf "%${padding}s" "")"
        else
            # ãƒã‚¤ãƒŠã‚¹ï¼ˆæ‚ªã„ï¼‰â†’èµ¤è‰²
            visible_str=$(printf "%.1f%%" "$diff")
            vs_team_str="${RED}${visible_str}${RESET}"
            # ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ç”¨ã«å¯è¦–æ–‡å­—åˆ—ã®é•·ã•ã‚’è¨ˆç®—ï¼ˆåˆ—å¹…14ï¼‰
            padding=$((14 - ${#visible_str}))
            vs_team_str="${vs_team_str}$(printf "%${padding}s" "")"
        fi
    else
        team_avg_rate_str="-"
        vs_team_str=$(printf "%-14s" "-")
    fi

    # å¹³å‡æ™‚é–“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    if [ "$avg_seconds" != "null" ] && [ -n "$avg_seconds" ]; then
        avg_time_str=$(format_seconds "$avg_seconds")
    else
        avg_time_str="-"
    fi

    # ãƒãƒ¼ãƒ å¹³å‡æ™‚é–“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    if [ "$team_avg_seconds" != "null" ] && [ -n "$team_avg_seconds" ]; then
        team_avg_time_str=$(format_seconds "$team_avg_seconds")

        # vs Team (Time) ã®å·®åˆ†ã‚’è¨ˆç®—ï¼ˆMå€é€Ÿã„/é…ã„ï¼‰
        if [ "$avg_seconds" != "null" ] && [ -n "$avg_seconds" ]; then
            # è‡ªåˆ†ã®æ–¹ãŒé€Ÿã„å ´åˆï¼šãƒãƒ¼ãƒ å¹³å‡ / è‡ªåˆ†ã®æ™‚é–“ = ä½•å€é€Ÿã„ã‹
            # è‡ªåˆ†ã®æ–¹ãŒé…ã„å ´åˆï¼šè‡ªåˆ†ã®æ™‚é–“ / ãƒãƒ¼ãƒ å¹³å‡ = ä½•å€é…ã„ã‹
            if (( $(awk "BEGIN {print ($avg_seconds < $team_avg_seconds)}") )); then
                # é€Ÿã„å ´åˆï¼ˆè‰¯ã„ï¼‰â†’ç·‘è‰²
                multiplier=$(awk "BEGIN {printf \"%.1f\", $team_avg_seconds / $avg_seconds}")
                visible_str=$(printf "%.1fxé€Ÿã„" "$multiplier")
                vs_team_time_str="${GREEN}${visible_str}${RESET}"
                # ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ç”¨ã«å¯è¦–æ–‡å­—åˆ—ã®é•·ã•ã‚’è¨ˆç®—ï¼ˆåˆ—å¹…13ï¼‰
                # æ—¥æœ¬èªã®ã€Œé€Ÿã„ã€ã¯2æ–‡å­—ã ãŒã€ãƒã‚¤ãƒˆæ•°ã§è¨ˆç®—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
                visible_len=$(echo -n "$visible_str" | wc -m | tr -d ' ')
                padding=$((13 - visible_len))
                vs_team_time_str="${vs_team_time_str}$(printf "%${padding}s" "")"
            elif (( $(awk "BEGIN {print ($avg_seconds > $team_avg_seconds)}") )); then
                # é…ã„å ´åˆï¼ˆæ‚ªã„ï¼‰â†’èµ¤è‰²
                multiplier=$(awk "BEGIN {printf \"%.1f\", $avg_seconds / $team_avg_seconds}")
                visible_str=$(printf "%.1fxé…ã„" "$multiplier")
                vs_team_time_str="${RED}${visible_str}${RESET}"
                # ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ç”¨ã«å¯è¦–æ–‡å­—åˆ—ã®é•·ã•ã‚’è¨ˆç®—ï¼ˆåˆ—å¹…13ï¼‰
                visible_len=$(echo -n "$visible_str" | wc -m | tr -d ' ')
                padding=$((13 - visible_len))
                vs_team_time_str="${vs_team_time_str}$(printf "%${padding}s" "")"
            else
                # åŒã˜
                vs_team_time_str=$(printf "%-13s" "åŒã˜")
            fi
        else
            vs_team_time_str=$(printf "%-13s" "-")
        fi
    else
        team_avg_time_str="-"
        vs_team_time_str=$(printf "%-13s" "-")
    fi

    # çµæœã‚’è¡¨ç¤º
    printf "%-20s | %-8s | %-8s | %-8s | %-10s | %s | %-16s | %-16s | %s\n" \
        "${repo:0:20}" "$total_others_count" "$reviewed_count" "$review_rate_str" "$team_avg_rate_str" "$vs_team_str" "$avg_time_str" "$team_avg_time_str" "$vs_team_time_str"

    # å…ƒã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æˆ»ã‚‹
    cd "$ORIGINAL_DIR"
done

echo "--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------"